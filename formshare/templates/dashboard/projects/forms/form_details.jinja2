{% extends 'dashboard/page.jinja2' %}
{% import 'dashboard/macros/form.jinja2' as form %}

{% block titlesection %}{{ formDetails.form_name }}{% endblock titlesection %}

{% block breadcrumbs %}
    {% include 'dashboard/projects/forms/snippets/brdcrbs_frmdtls.jinja2' %}
{% endblock breadcrumbs %}

{% block mainsection %}
    <div class="row">
        <div class="col-lg-3">
            <div class="wrapper wrapper-content project-manager">
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>{{ formDetails.form_name }}</h5>
                        <div class="ibox-tools">
                            {% if projectDetails.access_type != 4 %}
                                <a href="{{ request.route_url('form_edit',userid=projectDetails.owner, projcode=projectDetails.project_code, formid=formDetails.form_id) }}" style="margin-right: 10px">
                                    <i class="fa fa-pencil text-warning" title="{{ _('Edit') }}"></i>
                                </a>
                            {% endif %}
                            <a class="collapse-link" style="margin-right: 10px">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="fullscreen-link">
                                <i class="fa fa-expand"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        {% if formDetails.form_target > 0 %}
                            70 of {{ formDetails.form_target }} submissions
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated {% if formDetails.form_schema == None %}progress-bar-warning{% else %}progress-bar-success{% endif %}" style="width: 25%" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        {% endif %}
                        <p style="margin-top: 10px" class="small font-bold">
                            {% if formDetails.form_schema != None %}<span class="badge badge-primary">With repository</span>{% else %}<span class="badge badge-warning" title="{{ _('Data is not stored in a database') }}">{{ _('In testing') }}</span>{% endif %} {% if formDetails.form_accsub == 1 %}<span class="label label-primary" title="{{ _('Accept submissions') }}">{{ _('Active') }}</span>{% else %}<span class="label label-danger" title="{{ _('Does\'t accept submissions') }}">{{ _('Inactive') }}</span>{% endif %}
                        </p>
                        {% if projectDetails.access_type != 4 %}
                            <div class="actions">
                                {% if formDetails.form_schema == None %}
                                    <a href="" class="btn btn-xs btn-white"><i style="color: #1c84c6" class="fas fa-database"></i> {{ _('Create repository') }} </a>
                                {% else %}
                                    <a href="" class="btn btn-xs btn-white"><i style="color: #1c84c6" class="fas fa-code-branch"></i> {{ _('Upload new version') }} </a>
                                {% endif %}
                                {% if projectDetails.access_type == 1 or formDetails.pubby.user_id == activeUser.id %}
                                    <a urn="{{ request.route_url('delete_form', userid=projectDetails.owner, projcode=projectDetails.project_code, formid=formDetails.form_id) }}" class="btn btn-xs btn-white remove_form"><i style="color: red" class="far fa-trash-alt"></i> {{ _('Delete') }}</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>Form links</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up" style="margin-right: 10px"></i>
                            </a>
                            <a class="fullscreen-link">
                                <i class="fa fa-expand"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-12">
                                <small>Click/Tab and hold to copy</small>
                                <ul class="tag-list" style="padding: 0">
                                    {% if formDetails.form_schema != None %}
                                        <li><a href=""><i class="fa fa-rss"></i> OData endpoint</a></li>
                                        <li><a href=""><i class="fa fa-download"></i> Download data in XLS form</a></li>
                                        <li><a href=""><i class="fa fa-images"></i> Download images</a></li>
                                        <li><a href=""><i class="fa fa-pencil"></i> Clean data</a></li>
                                        <li><a href=""><i class="fa fa-bug"></i> Clean error logs</a></li>
                                    {% else %}
                                        <li><a href=""><i class="fa fa-download"></i> Download testing data in CSV form</a></li>
                                        <li><a href=""><i class="fa fa-images"></i> Download images</a></li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>Form files</h5>
                        <div class="ibox-tools">
                            <a id="add_file" data-toggle="modal" data-target="#upload_file" style="margin-right: 10px">
                                <i class="fa fa-plus-square text-success" title="Add new file"></i>
                            </a>
                            <a class="collapse-link" style="margin-right: 10px">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="fullscreen-link">
                                <i class="fa fa-expand"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-12">
                                <small>Click/Tab and hold to remove</small>
                                <ul class="tag-list" style="padding: 0">
                                    <li><a href=""><i class="fa fa-file-pdf-o"></i> Proposal.pdf</a></li>
                                    <li><a href=""><i class="fa fa-file-excel-o"></i> Report.xls</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>Assigned collaborator groups</h5>
                        <div class="ibox-tools">
                            <a style="margin-right: 10px">
                                <i class="fa fa-plus-square text-success" title="Assign new"></i>
                            </a>
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up" style="margin-right: 10px"></i>
                            </a>
                            <a class="fullscreen-link">
                                <i class="fa fa-expand"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-12">
                                <small>Click/Tab and hold to remove</small>
                                <ul class="tag-list" style="padding: 0">
                                    <li><a href=""> Carlos Quiros</a></li>
                                    <li><a href=""> Eduardo Quiros</a></li>
                                    <li><a href=""> Katie Tavenner</a></li>
                                    <li><a href=""> Flor Campos</a></li>
                                    <li><a href=""> Elizabeth Tavenner</a></li>
                                    <li><a href=""> Erick Lopez</a></li>
                                    <li><a href=""> Macho Ramirez</a></li>
                                    <li><a href=""> Begni Calderon</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>Assigned collaborators</h5>
                        <div class="ibox-tools">
                            <a style="margin-right: 10px">
                                <i class="fa fa-plus-square text-success" title="Assign new"></i>
                            </a>
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up" style="margin-right: 10px"></i>
                            </a>
                            <a class="fullscreen-link">
                                <i class="fa fa-expand"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-md-12">
                                <small>Click/Tab and hold to remove</small>
                                <ul class="tag-list" style="padding: 0">
                                    <li><a href=""> Carlos Quiros</a></li>
                                    <li><a href=""> Eduardo Quiros</a></li>
                                    <li><a href=""> Katie Tavenner</a></li>
                                    <li><a href=""> Flor Campos</a></li>
                                    <li><a class="text-danger" href=""> Elizabeth Tavenner</a></li>
                                    <li><a href=""> Erick Lopez</a></li>
                                    <li><a href=""> Macho Ramirez</a></li>
                                    <li><a href=""> Begni Calderon</a></li>
                                </ul>
                            </div>
                        </div>
                        <small>Collaborators in <span class="text-danger">red</span> are inactive</small>
                    </div>
                </div>

                <div class="text-center m-t-md">
                    <a href="#" class="btn btn-xs btn-warning">Edit form</a>
                </div>
            </div>
        </div>
        <div class="col-lg-9">
            <div class="wrapper wrapper-content animated fadeInUp">
                <div class="ibox">
                    <div class="ibox-content">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="m-b-md">
                                    <h2>Form details</h2>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right"><dt>{{ _('Created by') }}:</dt> </div>
                                    <div class="col-sm-8 text-sm-left"><dd class="mb-1">{{ formDetails.pubby.user_name }}</dd> </div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right"><dt>{{ _('Created') }}:</dt> </div>
                                    <div class="col-sm-8 text-sm-left"> <dd class="mb-1">  {{ request.h.readble_date(formDetails.form_cdate) }}</dd></div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right"><dt>{{ _('Last updated') }}:</dt> </div>
                                    <div class="col-sm-8 text-sm-left"> <dd class="mb-1">  {{ request.h.readble_date(formDetails.form_cdate) }}</dd></div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right"><dt>{{ _('Assistants') }}:</dt> </div>
                                    <div class="col-sm-8 text-sm-left"> <dd class="mb-1"> 3 <a>[Manage]</a></dd></div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right"><dt>{{ _('Assistant groups') }}:</dt> </div>
                                    <div class="col-sm-8 text-sm-left"> <dd class="mb-1"> 1 <a>[Manage]</a></dd></div>
                                </dl>
                            </div>
                            <div class="col-lg-6" id="cluster_info">
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right">
                                        <dt>Last Submission:</dt>
                                    </div>
                                    <div class="col-sm-8 text-sm-left">
                                        <dd class="mb-1">16.08.2014 12:15:57</dd>
                                    </div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right">
                                        <dt>Number of submissions:</dt>
                                    </div>
                                    <div class="col-sm-8 text-sm-left">
                                        <dd class="mb-1">10</dd>
                                    </div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right">
                                        <dt>In database:</dt>
                                    </div>
                                    <div class="col-sm-8 text-sm-left">
                                        <dd class="mb-1">7 <a>[Clean data]</a></dd>
                                    </div>
                                </dl>
                                <dl class="row mb-0">
                                    <div class="col-sm-4 text-sm-right">
                                        <dt>In error log:</dt>
                                    </div>
                                    <div class="col-sm-8 text-sm-left">
                                        <dd class="mb-1">3 <a>[Manage errors]</a></dd>
                                    </div>
                                </dl>
                            </div>
                        </div>
                        <div class="row m-t-sm">
                            <div class="col-lg-12">
                                <div class="ibox">
                                    <div class="ibox-title">
                                        <h5>Map</h5>
                                        <div class="ibox-tools">
                                            <a class="collapse-link" style="margin-right: 10px">
                                                <i class="fa fa-chevron-up"></i>
                                            </a>
                                            <a class="fullscreen-link">
                                                <i class="fa fa-expand"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="ibox-content">


                                    </div>
                                </div>
                                <div class="ibox">
                                    <div class="ibox-title">
                                        <h5>Analysis</h5>
                                        <div class="ibox-tools">
                                            <a class="collapse-link" style="margin-right: 10px">
                                                <i class="fa fa-chevron-up"></i>
                                            </a>
                                            <a class="fullscreen-link">
                                                <i class="fa fa-expand"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="ibox-content">
                                        <div class="row">
                                            <div class="col-md-10">

                                            </div>
                                            <div class="col-md-2">
                                                <div class="btn-group btn-block">
                                                    <button data-toggle="dropdown" style="margin-bottom: 10px" class="btn btn-block btn-primary dropdown-toggle">Add</button>
                                                    <ul class="dropdown-menu">
                                                        <li><a class="dropdown-item" href="#">Action</a></li>
                                                        <li><a class="dropdown-item" href="#" class="font-bold">Another action</a></li>
                                                        <li><a class="dropdown-item" href="#">Something else here</a></li>
                                                        <li class="dropdown-divider"></li>
                                                        <li><a class="dropdown-item"  href="#">Separated link</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ibox">
                                            <div class="ibox-title">
                                                <h5>Analysis 1</h5>
                                                <div class="ibox-tools">
                                                    <a class="collapse-link" style="margin-right: 10px">
                                                        <i class="fa fa-chevron-up"></i>
                                                    </a>
                                                    <a class="fullscreen-link">
                                                        <i class="fa fa-expand"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="ibox-content">
                                                <div class="scroll_content">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ibox collapsed">
                                    <div class="ibox-title">
                                        <h5>Activity</h5>
                                        <div class="ibox-tools">
                                            <a class="collapse-link" style="margin-right: 10px">
                                                <i class="fa fa-chevron-up"></i>
                                            </a>
                                            <a class="fullscreen-link">
                                                <i class="fa fa-expand"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="ibox-content">
                                        <div class="activity-stream">
                                            <div class="stream">
                                                <div class="stream-badge">
                                                    <i class="fa fa-pencil"></i>
                                                </div>
                                                <div class="stream-panel">
                                                    <div class="stream-info">
                                                        <a href="#">
                                                            <img src="img/a5.jpg" />
                                                            <span>Karen Miggel</span>
                                                            <span class="date">Today at 01:32:40 am</span>
                                                        </a>
                                                    </div>
                                                    Add new note to the <a href="#">Martex</a>  project.
                                                </div>
                                            </div>

                                            <div class="stream">
                                                <div class="stream-badge">
                                                    <i class="fa fa-commenting-o"></i>
                                                </div>
                                                <div class="stream-panel">
                                                    <div class="stream-info">
                                                        <a href="#">
                                                            <img src="img/a4.jpg" />
                                                            <span>John Mikkens</span>
                                                            <span class="date">Yesterday at 10:00:20 am</span>
                                                        </a>
                                                    </div>
                                                    Commented on <a href="#">Ariana</a> profile.
                                                </div>
                                            </div>
                                            <div class="stream">
                                                <div class="stream-badge">
                                                    <i class="fa fa-circle"></i>
                                                </div>
                                                <div class="stream-panel">
                                                    <div class="stream-info">
                                                        <a href="#">
                                                            <img src="img/a2.jpg" />
                                                            <img src="img/a3.jpg" />
                                                            <img src="img/a4.jpg" />
                                                            <span>Mike Johnson, Monica Smith and Karen Dortmund</span>
                                                            <span class="date">Yesterday at 02:13:20 am</span>
                                                        </a>
                                                    </div>
                                                    Changed status of third stage in the <a href="#">Vertex</a> project.
                                                </div>
                                            </div>
                                            <div class="stream">
                                                <div class="stream-badge">
                                                    <i class="fa fa-circle"></i>
                                                </div>
                                                <div class="stream-panel">
                                                    <div class="stream-info">
                                                        <a href="#">
                                                            <img src="img/a6.jpg" />
                                                            <span>Jessica Smith</span>
                                                            <span class="date">Yesterday at 08:14:41 am</span>
                                                        </a>
                                                    </div>
                                                    Add new files to own file sharing place.
                                                </div>
                                            </div>
                                            <div class="stream">
                                                <div class="stream-badge">
                                                    <i class="fa fa-send bg-primary"></i>
                                                </div>
                                                <div class="stream-panel">
                                                    <div class="stream-info">
                                                        <a href="#">
                                                            <img src="img/a7.jpg" />
                                                            <img src="img/a1.jpg" />
                                                            <span>Martha Farter and Mike Rodgers</span>
                                                            <span class="date">Yesterday at 04:18:13 am</span>
                                                        </a>
                                                    </div>
                                                    Sent email to all users participating in new project.
                                                </div>
                                            </div>
                                            <div class="stream">
                                                <div class="stream-badge">
                                                    <i class="fa fa-tag bg-warning"></i>
                                                </div>
                                                <div class="stream-panel">
                                                    <div class="stream-info">
                                                        <a href="#">
                                                            <img src="img/a7.jpg" />
                                                            <span>Mark Mickens</span>
                                                            <span class="date">Yesterday at 06:00:30 am</span>
                                                        </a>
                                                    </div>
                                                    Has been taged in the latest comments about the new project.
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'dashboard/projects/forms/snippets/upload_file.jinja2' %}
{% endblock mainsection %}

{% block scripts %}
    {{ super() }}
    <script>
        $(document).ready(function() {
            $('.remove_form').click(function () {
                var action_url = $( this ).attr('urn');
                swal({
                        title: "{{ _('Are you sure?') }}",
                        text: "{{ _('All the data in this form will be deleted!') }}",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "{{ _('Yes, delete this form!') }}",
                        cancelButtonText: "{{ _('Oops!, cancel!') }}",
                        closeOnConfirm: true,
                        closeOnCancel: true },
                    function (isConfirm) {
                        if (isConfirm) {
                            var form = document.createElement('form');
                            form.setAttribute('method', 'post');
                            form.setAttribute('action', action_url);
                            form.style.display = 'hidden';

                            var i = document.createElement("input"); //input element, text
                            i.setAttribute('type',"text");
                            i.setAttribute('name',"csrf_token");
                            i.setAttribute('value','{{ request.session.get_csrf_token() }}');
                            form.appendChild(i);

                            document.body.appendChild(form);
                            form.submit();
                        }
                    });
            });

            $( "#add_file" ).click(function() {
                $( "#clear_button").click();
            });

            $( "#uploadbutton" ).click(function() {
                $( "#filetoupload" ).click();
                $("#file_label").text('{{ _('File(s)') }}')
                $("#file_info").hide();
            });

            jQuery("#filetoupload").change(function () {
                var fileInput = document.getElementById('filetoupload');
                var fileNames = [];
                for (var i = 0; i < fileInput.files.length; i++) {
                    fileNames.push(fileInput.files[i].name);
                }
                //var filename = fileInput.files[0].name;
                var file_object = $("#form_file");
                file_object.val(fileNames.join(' , '));
                file_object.show();
                $("#clear_section").show();
                $("#uploadbutton").hide();
                $("#linkbutton").hide();
            });
            $( "#clear_button" ).click(function() {
                $("#filetoupload").val("");
                var file_object = $("#form_file");
                file_object.val("");
                file_object.hide();
                $("#clear_section").hide();
                $("#uploadbutton").show();
                $("#linkbutton").show();
                $("#file_label").text('{{ _('Type') }}');
                $("#file_info").hide();
                $("#file_name").val("");
            });
            $( "#linkbutton" ).click(function() {
                var file_object = $("#form_file");
                file_object.attr("placeholder", "http://example.com/files/my_file.csv").blur();
                file_object.show();
                $("#clear_section").show();
                $("#uploadbutton").hide();
                $("#linkbutton").hide();
                $("#file_label").text('{{ _('Link') }}');
                $("#file_info").show();
            });

        });
    </script>


{% endblock scripts %}